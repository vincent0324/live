<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui">
    <script src="http://assets.diandong.com/mobile/live/build/flexible.js"></script>
    <script src="../build/jquery.min.js">
    </script>
</head>

<body>

    <div class="wrap clearfix">
        <a href="" class="back-button">返回</a>
    </div>

    <div class="">
        <form action="">

            <div class="edit-item edit-item-top">
                <header class="edit-item-header">
                    <h3>是否置顶</h3>
                </header>
                <div class="edit-item-content">
                    <label for="ontop">置顶 <input type="checkbox" name="ontop" id="ontop"></label>
                </div>
            </div>

            <div class="edit-item edit-item-text">
                <header class="edit-item-header">
                    <h3>推文</h3>
                </header>
                <div class="edit-item-content">
                    <textarea name="push" id="push" placeholder="活动推文"></textarea>
                </div>
            </div>

            <div class="edit-item edit-item-location">
                <header class="edit-item-header">
                    <h3>地点</h3>
                </header>
                <div class="edit-item-content">
                    <input type="text" class="location" name="location" placeholder="活动地点">
                </div>
            </div>

            <div class="edit-item edit-item-photo">
                <header class="edit-item-header">
                    <h3>图片</h3>
                </header>
                <!-- <div class="edit-item-content">
                    <input type="file">
                    <input type="file">
                    <input type="file">
                    <input type="file">
                    <input type="file">
                    <input type="file">
                    <input type="file">
                    <input type="file">
                    <input type="file">
                </div> -->
            </div>


            <div class="upload">

                <div class="upload-item">
                    <input type="file" name="headpic_1" class="headpicinput_1" id="headpicinput_1" style="display: none;" onchange="UpLoad(this)">
                    <input type="hidden" id="imgUrl_1" class="imgUrl" name="imgUrl_1">
                    <div id="" class="cell cell_1">
                        <a href="javascript:void(0);" onclick="choosePic_1();"><img src="http://i1.dd-img.com/assets/image/1495764543-95352fde674ead19-200w-200h.png" id="preViewImg_1" class="preViewImg"></a>
                    </div>
                </div>

                <div class="upload-item">
                    <input type="file" name="headpic_2" class="headpicinput_2" id="headpicinput_2" style="display: none;" onchange="UpLoad(this)">
                    <input type="hidden" id="imgUrl_2" class="imgUrl" name="imgUrl_2">
                    <div id="" class="cell cell_2">
                        <a href="javascript:void(0);" onclick="choosePic_2();"><img src="http://i1.dd-img.com/assets/image/1495764543-95352fde674ead19-200w-200h.png" id="preViewImg_2" class="preViewImg"></a>
                    </div>
                </div>

                <div class="upload-item">
                    <input type="file" name="headpic_3" class="headpicinput_3" id="headpicinput_3" style="display: none;" onchange="UpLoad(this)">
                    <input type="hidden" id="imgUrl_3" class="imgUrl" name="imgUrl_3">
                    <div id="" class="cell cell_3">
                        <a href="javascript:void(0);" onclick="choosePic_3();"><img src="http://i1.dd-img.com/assets/image/1495764543-95352fde674ead19-200w-200h.png" id="preViewImg_3" class="preViewImg"></a>
                    </div>
                </div>

                <div class="upload-item">
                    <input type="file" name="headpic_4" class="headpicinput_4" id="headpicinput_4" style="display: none;" onchange="UpLoad(this)">
                    <input type="hidden" id="imgUrl_4" class="imgUrl" name="imgUrl_4">
                    <div id="" class="cell cell_4">
                        <a href="javascript:void(0);" onclick="choosePic_4();"><img src="http://i1.dd-img.com/assets/image/1495764543-95352fde674ead19-200w-200h.png" id="preViewImg_4" class="preViewImg"></a>
                    </div>
                </div>

                <div class="upload-item">
                    <input type="file" name="headpic_5" class="headpicinput_5" id="headpicinput_5" style="display: none;" onchange="UpLoad(this)">
                    <input type="hidden" id="imgUrl_5" class="imgUrl" name="imgUrl_5">
                    <div id="" class="cell cell_5">
                        <a href="javascript:void(0);" onclick="choosePic_5();"><img src="http://i1.dd-img.com/assets/image/1495764543-95352fde674ead19-200w-200h.png" id="preViewImg_5" class="preViewImg"></a>
                    </div>
                </div>

                <div class="upload-item">
                    <input type="file" name="headpic_6" class="headpicinput_6" id="headpicinput_6" style="display: none;" onchange="UpLoad(this)">
                    <input type="hidden" id="imgUrl_6" class="imgUrl" name="imgUrl_6">
                    <div id="" class="cell cell_6">
                        <a href="javascript:void(0);" onclick="choosePic_6();"><img src="http://i1.dd-img.com/assets/image/1495764543-95352fde674ead19-200w-200h.png" id="preViewImg_6" class="preViewImg"></a>
                    </div>
                </div>

                <div class="upload-item">
                    <input type="file" name="headpic_7" class="headpicinput_7" id="headpicinput_7" style="display: none;" onchange="UpLoad(this)">
                    <input type="hidden" id="imgUrl_7" class="imgUrl" name="imgUrl_7">
                    <div id="" class="cell cell_7">
                        <a href="javascript:void(0);" onclick="choosePic_7();"><img src="http://i1.dd-img.com/assets/image/1495764543-95352fde674ead19-200w-200h.png" id="preViewImg_7" class="preViewImg"></a>
                    </div>
                </div>

                <div class="upload-item">
                    <input type="file" name="headpic_8" class="headpicinput_8" id="headpicinput_8" style="display: none;" onchange="UpLoad(this)">
                    <input type="hidden" id="imgUrl_8" class="imgUrl" name="imgUrl_8">
                    <div id="" class="cell cell_8">
                        <a href="javascript:void(0);" onclick="choosePic_8();"><img src="http://i1.dd-img.com/assets/image/1495764543-95352fde674ead19-200w-200h.png" id="preViewImg_8" class="preViewImg"></a>
                    </div>
                </div>

                <div class="upload-item">
                    <input type="file" name="headpic_9" class="headpicinput_9" id="headpicinput_9" style="display: none;" onchange="UpLoad(this)">
                    <input type="hidden" id="imgUrl_9" class="imgUrl" name="imgUrl_9">
                    <div id="" class="cell cell_9">
                        <a href="javascript:void(0);" onclick="choosePic_9();"><img src="http://i1.dd-img.com/assets/image/1495764543-95352fde674ead19-200w-200h.png" id="preViewImg_9" class="preViewImg"></a>
                    </div>
                </div>

                <canvas id="canvas" style="display:none;"></canvas>
            </div>

            <script type="text/javascript">
                function choosePic_1() {
                    $('.headpicinput_1').click();
                };

                function choosePic_2() {
                    $('.headpicinput_2').click();
                };

                function choosePic_3() {
                    $('.headpicinput_3').click();
                };

                function choosePic_4() {
                    $('.headpicinput_4').click();
                };

                function choosePic_5() {
                    $('.headpicinput_5').click();
                };

                function choosePic_6() {
                    $('.headpicinput_6').click();
                };

                function choosePic_7() {
                    $('.headpicinput_7').click();
                };

                function choosePic_8() {
                    $('.headpicinput_8').click();
                };

                function choosePic_9() {
                    $('.headpicinput_9').click();
                };

                function UpLoad(e) {
                    var f = e.files[0];
                    fileType = f.type;

                    var parent = $(e).parents('.upload-item');

                    var imgUrlInput = parent.find('.imgUrl');
                    var preViewImg = parent.find('.preViewImg');
                    var imgUrl = parent.find('.imgUrl');

                    if (/image\/\w+/.test(fileType)) {
                        var fileReader = new FileReader();

                        fileReader.readAsDataURL(f);

                        fileReader.onload = function(event) {
                            var result = event.target.result; //返回的dataURL
                            var image = new Image();

                            image.src = result;
                            //若图片大小大于1M，压缩后再上传，否则直接上传

                            if (f.size > 1024 * 1024) {
                                image.onload = function() { //创建一个image对象，给canvas绘制使用
                                    var canvas = document.getElementById("canvas");
                                    canvas.width = this.width;
                                    canvas.height = this.height; //计算等比缩小后图片宽高
                                    var ctx = canvas.getContext('2d');
                                    ctx.drawImage(this, 0, 0, canvas.width, canvas.height);
                                    var newImageData = canvas.toDataURL(fileType, 0.8); //重新生成图片
                                    sendData = newImageData.replace("data:" + fileType + ";base64,", '');
                                    dataLength = base64decode(sendData).length; //base64位图片长度（这里没有写这个方法）

                                    // var imgUrlInput = $(e).next('.imgUrl');
                                    // var preViewImg = $(e).next('.preViewImg');

                                    // console.log(imgUrlInput);

                                    // $("#imgUrl").val(sendData);
                                    imgUrlInput.val(sendData);
                                    // $("#preViewImg").attr("src", newImageData);
                                    preViewImg.attr('src', newImageData);
                                    $("#canvas").hide();
                                }
                            } else {
                                image.onload = function() { //创建一个image对象，给canvas绘制使用
                                    sendData = result.replace("data:" + fileType + ";base64,", '');
                                    dataLength = base64decode(sendData).length;
                                    // $("#preViewImg").attr("src", result);
                                    // $("#imgUrl").val(sendData);

                                    preViewImg.attr('src', result);
                                    imgUrl.val(sendData);
                                }
                            }
                        }
                    } else {
                        alert("请选择图片");
                    }
                }

                var base64EncodeChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
                var base64DecodeChars = new Array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63, 52, 53,
                    54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37,
                    38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1);
                /**
                 * base64编码
                 * @param {Object} str
                 */
                function base64encode(str) {
                    var out, i, len;
                    var c1, c2, c3;
                    len = str.length;
                    i = 0;
                    out = "";
                    while (i < len) {
                        c1 = str.charCodeAt(i++) & 0xff;
                        if (i == len) {
                            out += base64EncodeChars.charAt(c1 >> 2);
                            out += base64EncodeChars.charAt((c1 & 0x3) << 4);
                            out += "==";
                            break;
                        }
                        c2 = str.charCodeAt(i++);
                        if (i == len) {
                            out += base64EncodeChars.charAt(c1 >> 2);
                            out += base64EncodeChars.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
                            out += base64EncodeChars.charAt((c2 & 0xF) << 2);
                            out += "=";
                            break;
                        }
                        c3 = str.charCodeAt(i++);
                        out += base64EncodeChars.charAt(c1 >> 2);
                        out += base64EncodeChars.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
                        out += base64EncodeChars.charAt(((c2 & 0xF) << 2) | ((c3 & 0xC0) >> 6));
                        out += base64EncodeChars.charAt(c3 & 0x3F);
                    }
                    return out;
                }
                /**
                 * base64解码
                 * @param {Object} str
                 */
                function base64decode(str) {
                    var c1, c2, c3, c4;
                    var i, len, out;
                    len = str.length;
                    i = 0;
                    out = "";
                    while (i < len) {
                        /* c1 */
                        do {
                            c1 = base64DecodeChars[str.charCodeAt(i++) & 0xff];
                        }
                        while (i < len && c1 == -1);
                        if (c1 == -1)
                            break;
                        /* c2 */
                        do {
                            c2 = base64DecodeChars[str.charCodeAt(i++) & 0xff];
                        }
                        while (i < len && c2 == -1);
                        if (c2 == -1)
                            break;
                        out += String.fromCharCode((c1 << 2) | ((c2 & 0x30) >> 4));
                        /* c3 */
                        do {
                            c3 = str.charCodeAt(i++) & 0xff;
                            if (c3 == 61)
                                return out;
                            c3 = base64DecodeChars[c3];
                        }
                        while (i < len && c3 == -1);
                        if (c3 == -1)
                            break;
                        out += String.fromCharCode(((c2 & 0XF) << 4) | ((c3 & 0x3C) >> 2));
                        /* c4 */
                        do {
                            c4 = str.charCodeAt(i++) & 0xff;
                            if (c4 == 61)
                                return out;
                            c4 = base64DecodeChars[c4];
                        }
                        while (i < len && c4 == -1);
                        if (c4 == -1)
                            break;
                        out += String.fromCharCode(((c3 & 0x03) << 6) | c4);
                    }
                    return out;
                }
                /**
                 * utf16转utf8
                 * @param {Object} str
                 */
                function utf16to8(str) {
                    var out, i, len, c;
                    out = "";
                    len = str.length;
                    for (i = 0; i < len; i++) {
                        c = str.charCodeAt(i);
                        if ((c >= 0x0001) && (c <= 0x007F)) {
                            out += str.charAt(i);
                        } else
                        if (c > 0x07FF) {
                            out += String.fromCharCode(0xE0 | ((c >> 12) & 0x0F));
                            out += String.fromCharCode(0x80 | ((c >> 6) & 0x3F));
                            out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));
                        } else {
                            out += String.fromCharCode(0xC0 | ((c >> 6) & 0x1F));
                            out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));
                        }
                    }
                    return out;
                }
                /**
                 * utf8转utf16
                 * @param {Object} str
                 */
                function utf8to16(str) {
                    var out, i, len, c;
                    var char2, char3;
                    out = "";
                    len = str.length;
                    i = 0;
                    while (i < len) {
                        c = str.charCodeAt(i++);
                        switch (c >> 4) {
                            case 0:
                            case 1:
                            case 2:
                            case 3:
                            case 4:
                            case 5:
                            case 6:
                            case 7:
                                // 0xxxxxxx
                                out += str.charAt(i - 1);
                                break;
                            case 12:
                            case 13:
                                // 110x xxxx 10xx xxxx
                                char2 = str.charCodeAt(i++);
                                out += String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F));
                                break;
                            case 14:
                                // 1110 xxxx10xx xxxx10xx xxxx
                                char2 = str.charCodeAt(i++);
                                char3 = str.charCodeAt(i++);
                                out += String.fromCharCode(((c & 0x0F) << 12) | ((char2 & 0x3F) << 6) | ((char3 & 0x3F) << 0));
                                break;
                        }
                    }
                    return out;
                }
            </script>

            <div class="edit-item edit-item-submit">
                <input type="submit" value="提交">
            </div>

        </form>
    </div>

    <script src="../build/edit.debug.js"></script>

</body>

</html>
